from bs4 import UnicodeDammit
import requests
from bs4 import BeautifulSoup
import pandas
import json
import math
import numpy
import argparse
import os

#cookie = 'WT_FPC=id=2df63e7698eb753e4b71522035157890:lv=1530105658180:ss=1530105619997; Drupal.tableDrag.showWeight=0; SecuritySettings=False&False; TS01cd45de=011ba33c7ef2c82cff8478475bb123f0f11ae4f5fb090252623e484e033398471e68369f4a4aaeeb33e7b20f1c3a5cf90d8259fd6b; has_js=1; TS01556f27=011ba33c7e82273c8efe0d5689fc64b7a314999e404fe4dd1700ae3f79124abb19bc798d950ad85d11041e4781980946b7047fd79d; TS01f4f82e=011ba33c7e4be36cf8d7b7832d17f10bd2ebd831dbf2df4dde93b9f708084360d5c123348ede9b8099e56b3495f9c1f9e02972148d70ac7406063ec3989a416742b1d57cbe; TS01556f27_30=01bbc726b12e61c19a0a7dd060364edd65d4fced530cbfbbb2d3c32b2cf849f2573aed1ef02571fcb9d557b1e8d30bc5d20f78c47e; SSESS9306d39d8ccd3bf0b5bb11e30ca9c761=WEXF7S13_Y3zKEH6rRcgTF1ilhMi0kc1kvm_h49MTQg; IGSession=tnev3owqkfe1epcfvm3zkfxx'

def build_deploymentid_key(observations,project_url,payload):#takes a dataframe, a project url and a request header and returns a dictionary of deployment ID pairs {string:ID,etc...}
    deploymentkey = {}
    for index, row in observations.iterrows():
        oldID = row['Deployment.ID']
        if type(oldID) is str:
            if oldID not in deploymentkey:
                print(oldID)
                deploymentkey[oldID] = extract_deploymentid(oldID,payload,project_url)
                print(deploymentkey[oldID])
        else:
            print("Error on :: "+str(index))
            print(oldID)
    return deploymentkey

def get_species_pages(pages,cookie,url='https://emammal.si.edu/views/ajax'):
    allspecies = {}
    #specieslist = []
    for pagenumber in range(0,pages):
        print("Page number::::: "+str(pagenumber))
        payload = {"Accept": "application/json, text/javascript, */*; q=0.01",
            "Accept-Encoding": "gzip, deflate, br",
            "Accept-Language": "en-US,en;q=0.5",
            "Cache-Control": "no-cache",
            "Connection": "keep-alive",
            "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8",
            "Cookie": cookie,
            "Host": "emammal.si.edu",
            "Pragma": "no-cache",
            "Referer": "https://emammal.si.edu/admin/content",
            "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:59.0) Gecko/20100101 Firefox/59.0",
            "X-Requested-With": "XMLHttpRequest"}
        #this is the entire body of the HTTP post request that occurs when you load a page of species from the content list. At character 408 there is a page number variable.
        body = 'view_name=oa_admin_views_node&view_display_id=oa_system&view_args=&view_path=admin%2Fcontent&view_base_path=admin%2Fcontent&view_dom_id=e06f9e8aeda74fcd5831cfce3d513a87&pager_element=0&type=species&og_group_ref_target_id=All&og_group_ref_target_id_mine=0&oa_section_ref_target_id=All&status=All&vid=All&flagged=0&og_subspaces_view_all=0&og_subspaces_view_parent=0&order=title&sort=asc&page='+str(pagenumber)+'&ajax_html_ids%5B%5D=skip-link&ajax_html_ids%5B%5D=navbar-administration&ajax_html_ids%5B%5D=navbar-bar&ajax_html_ids%5B%5D=navbar-tab-navbar-tray&ajax_html_ids%5B%5D=navbar-tab-navbar-tray--2&ajax_html_ids%5B%5D=navbar-tab-navbar-tray--3&ajax_html_ids%5B%5D=navbar-tray&ajax_html_ids%5B%5D=navbar-link-admin-apps&ajax_html_ids%5B%5D=navbar-link-admin-content&ajax_html_ids%5B%5D=navbar-link-node-add&ajax_html_ids%5B%5D=navbar-link-admin-content-comment&ajax_html_ids%5B%5D=navbar-link-admin-content-em-duplicates&ajax_html_ids%5B%5D=navbar-link-admin-content-file&ajax_html_ids%5B%5D=navbar-link-admin-content-emammal-admin-favorite-photos&ajax_html_ids%5B%5D=navbar-link-admin-content-deployment-durations&ajax_html_ids%5B%5D=navbar-link-admin-panopoly&ajax_html_ids%5B%5D=navbar-link-admin-panopoly-layouts&ajax_html_ids%5B%5D=navbar-link-admin-panopoly-pages&ajax_html_ids%5B%5D=navbar-link-admin-panopoly-panes&ajax_html_ids%5B%5D=navbar-link-admin-panopoly-settings&ajax_html_ids%5B%5D=navbar-link-admin-panopoly-settings-panopoly_admin&ajax_html_ids%5B%5D=navbar-link-admin-panopoly-settings-panopoly_core&ajax_html_ids%5B%5D=navbar-link-admin-panopoly-settings-panopoly_magic&ajax_html_ids%5B%5D=navbar-link-admin-panopoly-settings-panopoly_users&ajax_html_ids%5B%5D=navbar-link-admin-panopoly-settings-panopoly_wysiwyg&ajax_html_ids%5B%5D=navbar-link-admin-panopoly-settings-panopoly_widgets&ajax_html_ids%5B%5D=navbar-link-admin-structure&ajax_html_ids%5B%5D=navbar-link-admin-structure-block&ajax_html_ids%5B%5D=navbar-link-admin-structure-command-buttons&ajax_html_ids%5B%5D=navbar-link-admin-structure-contact&ajax_html_ids%5B%5D=navbar-link-admin-structure-types&ajax_html_ids%5B%5D=navbar-link-admin-structure-defaultconfig&ajax_html_ids%5B%5D=navbar-link-admin-structure-extensions&ajax_html_ids%5B%5D=navbar-link-admin-structure-features&ajax_html_ids%5B%5D=navbar-link-admin-structure-feeds&ajax_html_ids%5B%5D=navbar-link-admin-structure-dependencies&ajax_html_ids%5B%5D=navbar-link-admin-structure-fieldable-panels-panes&ajax_html_ids%5B%5D=navbar-link-admin-structure-file-types&ajax_html_ids%5B%5D=navbar-link-admin-structure-flags&ajax_html_ids%5B%5D=navbar-link-admin-structure-menu&ajax_html_ids%5B%5D=navbar-link-admin-structure-menu-manage-main-menu&ajax_html_ids%5B%5D=navbar-link-admin-structure-menu-manage-management&ajax_html_ids%5B%5D=navbar-link-admin-structure-menu-manage-navigation&ajax_html_ids%5B%5D=navbar-link-admin-structure-menu-manage-menu-resources&ajax_html_ids%5B%5D=navbar-link-admin-structure-menu-manage-user-menu&ajax_html_ids%5B%5D=navbar-link-admin-structure-messages&ajax_html_ids%5B%5D=navbar-link-admin-structure-mini-panels&ajax_html_ids%5B%5D=navbar-link-admin-structure-pages&ajax_html_ids%5B%5D=navbar-link-admin-structure-panelizer&ajax_html_ids%5B%5D=navbar-link-admin-structure-panels&ajax_html_ids%5B%5D=navbar-link-admin-structure-paragraphs&ajax_html_ids%5B%5D=navbar-link-admin-structure-services&ajax_html_ids%5B%5D=navbar-link-admin-structure-taxonomy&ajax_html_ids%5B%5D=navbar-link-admin-structure-views&ajax_html_ids%5B%5D=navbar-link-admin-structure-wizards&ajax_html_ids%5B%5D=navbar-link-admin-appearance&ajax_html_ids%5B%5D=navbar-link-admin-people&ajax_html_ids%5B%5D=navbar-link-admin-modules&ajax_html_ids%5B%5D=navbar-link-admin-config&ajax_html_ids%5B%5D=navbar-link-admin-config-people&ajax_html_ids%5B%5D=navbar-link-admin-config-people-accounts&ajax_html_ids%5B%5D=navbar-link-admin-config-people-captcha&ajax_html_ids%5B%5D=navbar-link-admin-config-people-masquerade&ajax_html_ids%5B%5D=navbar-link-admin-config-people-realname&ajax_html_ids%5B%5D=navbar-link-admin-config-people-user_picture_field&ajax_html_ids%5B%5D=navbar-link-admin-config-people-ip-blocking&ajax_html_ids%5B%5D=navbar-link-admin-config-system&ajax_html_ids%5B%5D=navbar-link-admin-config-system-site-information&ajax_html_ids%5B%5D=navbar-link-admin-config-system-actions&ajax_html_ids%5B%5D=navbar-link-admin-config-system-apps&ajax_html_ids%5B%5D=navbar-link-admin-config-system-backup_migrate&ajax_html_ids%5B%5D=navbar-link-admin-config-system-fasttoggle&ajax_html_ids%5B%5D=navbar-link-admin-config-system-globalredirect&ajax_html_ids%5B%5D=navbar-link-admin-config-system-googleanalytics&ajax_html_ids%5B%5D=navbar-link-admin-config-system-htmlmail&ajax_html_ids%5B%5D=navbar-link-admin-config-system-mailsystem&ajax_html_ids%5B%5D=navbar-link-admin-config-system-memcache&ajax_html_ids%5B%5D=navbar-link-admin-config-system-message&ajax_html_ids%5B%5D=navbar-link-admin-config-system-message-text-copy&ajax_html_ids%5B%5D=navbar-link-admin-config-system-mimemail&ajax_html_ids%5B%5D=navbar-link-admin-config-system-uuid&ajax_html_ids%5B%5D=navbar-link-admin-config-system-emammal-api&ajax_html_ids%5B%5D=navbar-link-admin-config-system-cron&ajax_html_ids%5B%5D=navbar-link-admin-config-content&ajax_html_ids%5B%5D=navbar-link-admin-config-content-diff&ajax_html_ids%5B%5D=navbar-link-admin-config-content-entityconnect&ajax_html_ids%5B%5D=navbar-link-admin-config-content-geocoder&ajax_html_ids%5B%5D=navbar-link-admin-config-content-linkit&ajax_html_ids%5B%5D=navbar-link-admin-config-content-clone&ajax_html_ids%5B%5D=navbar-link-admin-config-content-node_export&ajax_html_ids%5B%5D=navbar-link-admin-config-content-formats&ajax_html_ids%5B%5D=navbar-link-admin-config-content-webform&ajax_html_ids%5B%5D=navbar-link-admin-config-content-wysiwyg&ajax_html_ids%5B%5D=navbar-link-admin-config-content-tablefield&ajax_html_ids%5B%5D=navbar-link-admin-config-fields&ajax_html_ids%5B%5D=navbar-link-admin-config-fields-field_hidden&ajax_html_ids%5B%5D=navbar-link-admin-config-user-interface&ajax_html_ids%5B%5D=navbar-link-admin-config-user-interface-chosen&ajax_html_ids%5B%5D=navbar-link-admin-config-user-interface-colors&ajax_html_ids%5B%5D=navbar-link-admin-config-user-interface-contextual-tabs&ajax_html_ids%5B%5D=navbar-link-admin-config-user-interface-dhtml_menu&ajax_html_ids%5B%5D=navbar-link-admin-config-user-interface-fullcalendar&ajax_html_ids%5B%5D=navbar-link-admin-config-user-interface-menu-block&ajax_html_ids%5B%5D=navbar-link-admin-config-user-interface-modulefilter&ajax_html_ids%5B%5D=navbar-link-admin-config-user-interface-shortcut&ajax_html_ids%5B%5D=navbar-link-admin-config-date&ajax_html_ids%5B%5D=navbar-link-admin-config-date-date_popup&ajax_html_ids%5B%5D=navbar-link-admin-config-development&ajax_html_ids%5B%5D=navbar-link-admin-config-development-performance&ajax_html_ids%5B%5D=navbar-link-admin-config-development-logging&ajax_html_ids%5B%5D=navbar-link-admin-config-development-maintenance&ajax_html_ids%5B%5D=navbar-link-admin-config-development-devel&ajax_html_ids%5B%5D=navbar-link-admin-config-development-strongarm&ajax_html_ids%5B%5D=navbar-link-admin-config-development-varnish&ajax_html_ids%5B%5D=navbar-link-admin-config-development-jquery_update&ajax_html_ids%5B%5D=navbar-link-admin-config-media&ajax_html_ids%5B%5D=navbar-link-admin-config-media-file-system&ajax_html_ids%5B%5D=navbar-link-admin-config-media-breakpoints&ajax_html_ids%5B%5D=navbar-link-admin-config-media-colorbox&ajax_html_ids%5B%5D=navbar-link-admin-config-media-file-settings&ajax_html_ids%5B%5D=navbar-link-admin-config-media-image-styles&ajax_html_ids%5B%5D=navbar-link-admin-config-media-manualcrop&ajax_html_ids%5B%5D=navbar-link-admin-config-media-browser&ajax_html_ids%5B%5D=navbar-link-admin-config-media-image-toolkit&ajax_html_ids%5B%5D=navbar-link-admin-config-search&ajax_html_ids%5B%5D=navbar-link-admin-config-search-settings&ajax_html_ids%5B%5D=navbar-link-admin-config-search-path&ajax_html_ids%5B%5D=navbar-link-admin-config-search-search_api&ajax_html_ids%5B%5D=navbar-link-admin-config-search-clean-urls&ajax_html_ids%5B%5D=navbar-link-admin-config-group&ajax_html_ids%5B%5D=navbar-link-admin-config-group-variable&ajax_html_ids%5B%5D=navbar-link-admin-config-group-context&ajax_html_ids%5B%5D=navbar-link-admin-config-group-fields&ajax_html_ids%5B%5D=navbar-link-admin-config-group-group-membership&ajax_html_ids%5B%5D=navbar-link-admin-config-group-permissions&ajax_html_ids%5B%5D=navbar-link-admin-config-group-permissions-node-oa_group&ajax_html_ids%5B%5D=navbar-link-admin-config-group-permissions-node-oa_space&ajax_html_ids%5B%5D=navbar-link-admin-config-group-roles&ajax_html_ids%5B%5D=navbar-link-admin-config-group-roles-node-oa_group&ajax_html_ids%5B%5D=navbar-link-admin-config-group-roles-node-oa_space&ajax_html_ids%5B%5D=navbar-link-admin-config-group-settings&ajax_html_ids%5B%5D=navbar-link-admin-config-group-og-vocab&ajax_html_ids%5B%5D=navbar-link-admin-config-regional&ajax_html_ids%5B%5D=navbar-link-admin-config-regional-settings&ajax_html_ids%5B%5D=navbar-link-admin-config-regional-date-time&ajax_html_ids%5B%5D=navbar-link-admin-config-regional-countries&ajax_html_ids%5B%5D=navbar-link-admin-config-administration&ajax_html_ids%5B%5D=navbar-link-admin-config-administration-admin_menu&ajax_html_ids%5B%5D=navbar-link-admin-config-services&ajax_html_ids%5B%5D=navbar-link-admin-config-services-rss-publishing&ajax_html_ids%5B%5D=navbar-link-admin-config-services-sianct_api&ajax_html_ids%5B%5D=navbar-link-admin-config-services-services-security&ajax_html_ids%5B%5D=navbar-link-admin-config-workflow&ajax_html_ids%5B%5D=navbar-link-admin-config-workflow-rules&ajax_html_ids%5B%5D=navbar-link-admin-config-spam_protection&ajax_html_ids%5B%5D=navbar-link-admin-config-spam_protection-google_recaptcha&ajax_html_ids%5B%5D=navbar-link-admin-course&ajax_html_ids%5B%5D=navbar-link-admin-course-appearance&ajax_html_ids%5B%5D=navbar-link-admin-course-enrollment-types&ajax_html_ids%5B%5D=navbar-link-admin-course-enrollment&ajax_html_ids%5B%5D=navbar-link-admin-course-object&ajax_html_ids%5B%5D=navbar-link-admin-course-report&ajax_html_ids%5B%5D=navbar-link-admin-openatrium&ajax_html_ids%5B%5D=navbar-link-admin-openatrium-setting&ajax_html_ids%5B%5D=navbar-link-admin-openatrium-groups&ajax_html_ids%5B%5D=navbar-link-admin-openatrium-sandbox&ajax_html_ids%5B%5D=navbar-link-admin-openatrium-section-templates&ajax_html_ids%5B%5D=navbar-link-admin-openatrium-space-templates&ajax_html_ids%5B%5D=navbar-link-admin-quiz&ajax_html_ids%5B%5D=navbar-link-admin-quiz-feedback&ajax_html_ids%5B%5D=navbar-link-admin-quiz-reports&ajax_html_ids%5B%5D=navbar-link-admin-quiz-result_answer&ajax_html_ids%5B%5D=navbar-link-admin-quiz-result&ajax_html_ids%5B%5D=navbar-link-admin-quiz-settings&ajax_html_ids%5B%5D=navbar-link-admin-quiz-settings-questions_settings&ajax_html_ids%5B%5D=navbar-link-admin-quiz-settings-config&ajax_html_ids%5B%5D=navbar-link-admin-quiz-settings-quiz-form&ajax_html_ids%5B%5D=navbar-link-admin-quiz-quiz-unevaluated-results&ajax_html_ids%5B%5D=navbar-link-admin-reports&ajax_html_ids%5B%5D=navbar-link-admin-reports-status&ajax_html_ids%5B%5D=navbar-link-admin-reports-updates&ajax_html_ids%5B%5D=navbar-link-admin-reports-course&ajax_html_ids%5B%5D=navbar-link-admin-reports-course-overview&ajax_html_ids%5B%5D=navbar-link-admin-reports-feeds&ajax_html_ids%5B%5D=navbar-link-admin-reports-fields&ajax_html_ids%5B%5D=navbar-link-admin-reports-insecure-view-displays&ajax_html_ids%5B%5D=navbar-link-admin-reports-varnish&ajax_html_ids%5B%5D=navbar-link-admin-reports-views-plugins&ajax_html_ids%5B%5D=navbar-link-admin-reports-emammal-admin-academy-quiz-scores&ajax_html_ids%5B%5D=navbar-link-admin-reports-memcache&ajax_html_ids%5B%5D=navbar-tray--2&ajax_html_ids%5B%5D=navbar-tray--3&ajax_html_ids%5B%5D=oa-navbar&ajax_html_ids%5B%5D=oa-navbar-spaces&ajax_html_ids%5B%5D=oa-navbar-admin&ajax_html_ids%5B%5D=oa-navbar-search&ajax_html_ids%5B%5D=oa-navbar-user&ajax_html_ids%5B%5D=mini-panel-oa_toolbar_panel&ajax_html_ids%5B%5D=oa-user-badge&ajax_html_ids%5B%5D=user-badge-dropdown&ajax_html_ids%5B%5D=toolbar-menu-button&ajax_html_ids%5B%5D=favorites-dropdown&ajax_html_ids%5B%5D=oa-navbar-spaces&ajax_html_ids%5B%5D=oa-navbar-admin&ajax_html_ids%5B%5D=oa-navbar-search&ajax_html_ids%5B%5D=oa-navbar-user&ajax_html_ids%5B%5D=mini-panel-oa_toolbar_panel&ajax_html_ids%5B%5D=oa-user-badge&ajax_html_ids%5B%5D=user-badge-dropdown&ajax_html_ids%5B%5D=toolbar-menu-button&ajax_html_ids%5B%5D=favorites-dropdown&ajax_html_ids%5B%5D=main-wrapper&ajax_html_ids%5B%5D=main&ajax_html_ids%5B%5D=breadcrumb&ajax_html_ids%5B%5D=messages&ajax_html_ids%5B%5D=content&ajax_html_ids%5B%5D=main-content&ajax_html_ids%5B%5D=page-title&ajax_html_ids%5B%5D=block-system-main&ajax_html_ids%5B%5D=views-exposed-form-oa-admin-views-node-oa-system-e06f9e8aeda74fcd5831cfce3d513a87&ajax_html_ids%5B%5D=edit-title-wrapper&ajax_html_ids%5B%5D=edit-title&ajax_html_ids%5B%5D=-wrapper&ajax_html_ids%5B%5D=s2id_edit-og-group-ref-target-id&ajax_html_ids%5B%5D=select2-chosen-6&ajax_html_ids%5B%5D=s2id_autogen6&ajax_html_ids%5B%5D=s2id_autogen6_search&ajax_html_ids%5B%5D=select2-results-6&ajax_html_ids%5B%5D=edit-og-group-ref-target-id&ajax_html_ids%5B%5D=edit-og-group-ref-target-id-mine&ajax_html_ids%5B%5D=edit-og-subspaces-view-all&ajax_html_ids%5B%5D=edit-og-subspaces-view-parent&ajax_html_ids%5B%5D=edit-oa-section-ref-target-id-wrapper&ajax_html_ids%5B%5D=edit-oa-section-ref-target-id&ajax_html_ids%5B%5D=edit-type-wrapper&ajax_html_ids%5B%5D=edit-type&ajax_html_ids%5B%5D=edit-author-wrapper&ajax_html_ids%5B%5D=edit-author&ajax_html_ids%5B%5D=edit-author-autocomplete&ajax_html_ids%5B%5D=edit-author-autocomplete-aria-live&ajax_html_ids%5B%5D=edit-status-wrapper&ajax_html_ids%5B%5D=edit-status&ajax_html_ids%5B%5D=edit-vid-wrapper&ajax_html_ids%5B%5D=edit-vid&ajax_html_ids%5B%5D=edit-flagged-wrapper&ajax_html_ids%5B%5D=edit-flagged&ajax_html_ids%5B%5D=edit-submit-oa-admin-views-node&ajax_html_ids%5B%5D=edit-reset&ajax_html_ids%5B%5D=views-form-oa-admin-views-node-oa-system&ajax_html_ids%5B%5D=edit-select&ajax_html_ids%5B%5D=edit-operation&ajax_html_ids%5B%5D=edit-submit--2&ajax_html_ids%5B%5D=edit-views-bulk-operations-0&ajax_html_ids%5B%5D=edit-views-bulk-operations-1&ajax_html_ids%5B%5D=edit-views-bulk-operations-2&ajax_html_ids%5B%5D=edit-views-bulk-operations-3&ajax_html_ids%5B%5D=edit-views-bulk-operations-4&ajax_html_ids%5B%5D=edit-views-bulk-operations-5&ajax_html_ids%5B%5D=edit-views-bulk-operations-6&ajax_html_ids%5B%5D=edit-views-bulk-operations-7&ajax_html_ids%5B%5D=edit-views-bulk-operations-8&ajax_html_ids%5B%5D=edit-views-bulk-operations-9&ajax_html_ids%5B%5D=edit-views-bulk-operations-10&ajax_html_ids%5B%5D=edit-views-bulk-operations-11&ajax_html_ids%5B%5D=edit-views-bulk-operations-12&ajax_html_ids%5B%5D=edit-views-bulk-operations-13&ajax_html_ids%5B%5D=edit-views-bulk-operations-14&ajax_html_ids%5B%5D=edit-views-bulk-operations-15&ajax_html_ids%5B%5D=edit-views-bulk-operations-16&ajax_html_ids%5B%5D=edit-views-bulk-operations-17&ajax_html_ids%5B%5D=edit-views-bulk-operations-18&ajax_html_ids%5B%5D=edit-views-bulk-operations-19&ajax_html_ids%5B%5D=edit-views-bulk-operations-20&ajax_html_ids%5B%5D=edit-views-bulk-operations-21&ajax_html_ids%5B%5D=edit-views-bulk-operations-22&ajax_html_ids%5B%5D=edit-views-bulk-operations-23&ajax_html_ids%5B%5D=edit-views-bulk-operations-24&ajax_html_ids%5B%5D=edit-views-bulk-operations-25&ajax_html_ids%5B%5D=edit-views-bulk-operations-26&ajax_html_ids%5B%5D=edit-views-bulk-operations-27&ajax_html_ids%5B%5D=edit-views-bulk-operations-28&ajax_html_ids%5B%5D=edit-views-bulk-operations-29&ajax_html_ids%5B%5D=edit-views-bulk-operations-30&ajax_html_ids%5B%5D=edit-views-bulk-operations-31&ajax_html_ids%5B%5D=edit-views-bulk-operations-32&ajax_html_ids%5B%5D=edit-views-bulk-operations-33&ajax_html_ids%5B%5D=edit-views-bulk-operations-34&ajax_html_ids%5B%5D=edit-views-bulk-operations-35&ajax_html_ids%5B%5D=edit-views-bulk-operations-36&ajax_html_ids%5B%5D=edit-views-bulk-operations-37&ajax_html_ids%5B%5D=edit-views-bulk-operations-38&ajax_html_ids%5B%5D=edit-views-bulk-operations-39&ajax_html_ids%5B%5D=edit-views-bulk-operations-40&ajax_html_ids%5B%5D=edit-views-bulk-operations-41&ajax_html_ids%5B%5D=edit-views-bulk-operations-42&ajax_html_ids%5B%5D=edit-views-bulk-operations-43&ajax_html_ids%5B%5D=edit-views-bulk-operations-44&ajax_html_ids%5B%5D=edit-views-bulk-operations-45&ajax_html_ids%5B%5D=edit-views-bulk-operations-46&ajax_html_ids%5B%5D=edit-views-bulk-operations-47&ajax_html_ids%5B%5D=edit-views-bulk-operations-48&ajax_html_ids%5B%5D=edit-views-bulk-operations-49&ajax_html_ids%5B%5D=block-course-navigation&ajax_html_ids%5B%5D=course-nav&ajax_html_ids%5B%5D=push&ajax_html_ids%5B%5D=footer&ajax_html_ids%5B%5D=mini-panel-oa_footer_panel&ajax_html_ids%5B%5D=admin-menu&ajax_html_ids%5B%5D=admin-menu-wrapper&ajax_html_ids%5B%5D=admin-menu-icon&ajax_html_ids%5B%5D=admin-menu-menu&ajax_html_ids%5B%5D=admin-menu-account&ajax_page_state%5Btheme%5D=emammal_oa_radix&ajax_page_state%5Btheme_token%5D=e1prwkbbQE3n9gN9wjauO9ObjdqoJ-8O9HQmSVf4_5U&ajax_page_state%5Bcss%5D%5B0%5D=1&ajax_page_state%5Bcss%5D%5Bmodules%2Fsystem%2Fsystem.base.css%5D=1&ajax_page_state%5Bcss%5D%5Bmodules%2Fsystem%2Fsystem.messages.css%5D=1&ajax_page_state%5Bcss%5D%5Bmodules%2Fsystem%2Fsystem.theme.css%5D=1&ajax_page_state%5Bcss%5D%5Bmisc%2Fui%2Fjquery.ui.theme.css%5D=1&ajax_page_state%5Bcss%5D%5Bmisc%2Fui%2Fjquery.ui.accordion.css%5D=1&ajax_page_state%5Bcss%5D%5Bmodules%2Fsystem%2Fsystem.admin.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Flibraries%2Fselect2%2Fselect2.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fselect2widget%2Fcss%2Fselect2widget.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Flibraries%2Fchosen%2Fchosen.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fchosen%2Fcss%2Fchosen-drupal.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fmedia%2Fcss%2Fmedia.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fnavbar%2Fcss%2Fnavbar.menu.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fnavbar%2Fcss%2Fnavbar-overlay.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fnavbar%2Fcss%2Fnavbar.base.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fnavbar%2Fcss%2Fnavbar.theme.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fnavbar%2Fcss%2Fnavbar.icons.css%5D=1&ajax_page_state%5Bcss%5D%5Bmodules%2Fcomment%2Fcomment.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fcontextual_tabs%2Fcontextual_tabs.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fdate%2Fdate_api%2Fdate.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fdate%2Fdate_popup%2Fthemes%2Fdatepicker.1.7.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fdate%2Fdate_repeat_field%2Fdate_repeat_field.css%5D=1&ajax_page_state%5Bcss%5D%5Bmodules%2Ffield%2Ftheme%2Ffield.css%5D=1&ajax_page_state%5Bcss%5D%5Bsites%2Fall%2Fmodules%2Fcontrib%2Ffield_hidden%2Ffield_hidden.css%5D=1&ajax_page_state%5Bcss%5D%5Bmodules%2Fnode%2Fnode.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fapps%2Foa_appearance%2Foa_appearance.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Foa_core%2Fcss%2Foa_core.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fapps%2Foa_events%2Foa-events.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fapps%2Foa_media%2Foa_media.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fapps%2Foa_notifications%2Foa_notifications.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fapps%2Foa_related%2Foa_related.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Foa_core%2Fmodules%2Foa_river%2Foa_river.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Foa_core%2Fmodules%2Foa_sections%2Foa_sections.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fapps%2Foa_subspaces%2Foa-subspaces.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Foa_core%2Fmodules%2Foa_teams%2Foa_teams.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fapps%2Foa_toolbar%2Fcss%2Foa_toolbar.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Foa_core%2Fmodules%2Foa_widgets%2Foa_widgets.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fapps%2Foa_wiki%2Foa_wiki.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fpanopoly%2Fpanopoly_admin%2Fpanopoly-admin-navbar.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fpanopoly%2Fpanopoly_core%2Fcss%2Fpanopoly-dropbutton.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fpanopoly%2Fpanopoly_magic%2Fcss%2Fpanopoly-magic.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fpanopoly%2Fpanopoly_theme%2Fcss%2Fpanopoly-featured.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fpanopoly%2Fpanopoly_theme%2Fcss%2Fpanopoly-accordian.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fpanopoly%2Fpanopoly_theme%2Fcss%2Fpanopoly-layouts.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fpanopoly%2Fpanopoly_widgets%2Fpanopoly-widgets.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fpanopoly%2Fpanopoly_widgets%2Fpanopoly-widgets-spotlight.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fpanopoly%2Fpanopoly_wysiwyg%2Fpanopoly-wysiwyg.css%5D=1&ajax_page_state%5Bcss%5D%5Bsites%2Fall%2Fmodules%2Fcontrib%2Fquiz%2Fquiz.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fradix_layouts%2Fradix_layouts.css%5D=1&ajax_page_state%5Bcss%5D%5Bmodules%2Fsearch%2Fsearch.css%5D=1&ajax_page_state%5Bcss%5D%5Bmodules%2Fuser%2Fuser.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fviews%2Fcss%2Fviews.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fcaption_filter%2Fcaption-filter.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fadmin_menu%2Fadmin_menu.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fadmin_menu%2Fadmin_menu_toolbar%2Fadmin_menu_toolbar.css%5D=1&ajax_page_state%5Bcss%5D%5Bmodules%2Fshortcut%2Fshortcut.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fctools%2Fcss%2Fctools.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fdhtml_menu%2Fdhtml_menu.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Foa_core%2Fmodules%2Foa_diff%2Foa_diff.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fpanels%2Fcss%2Fpanels.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fadmin_views%2Fadmin_views.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fviews_bulk_operations%2Fcss%2Fviews_bulk_operations.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fapps%2Foa_search%2Foa_search.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fflag%2Ftheme%2Fflag.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fapps%2Foa_favorites%2Foa_favorites.css%5D=1&ajax_page_state%5Bcss%5D%5Bsites%2Fall%2Fmodules%2Fcustom%2Femammal%2Fcss%2Fblock--emammal-social.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fpanels%2Fplugins%2Flayouts%2Fonecol%2Fonecol.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fapps%2Foa_brand%2Foa_brand_logo.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fthemes%2Foa_radix%2Fassets%2Fstylesheets%2Fscreen.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fthemes%2Foa_radix%2Fassets%2Fstylesheets%2Ffont-awesome.min.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fthemes%2Foa_radix%2Fassets%2Fstylesheets%2Ffont-awesome32.min.css%5D=1&ajax_page_state%5Bcss%5D%5Bsites%2Fall%2Fthemes%2Femammal_oa_radix%2Fassets%2Fstylesheets%2Fsub-screen.css%5D=1&ajax_page_state%5Bcss%5D%5Bsites%2Fall%2Fthemes%2Femammal_oa_radix%2Fassets%2Fstylesheets%2Fprint.css%5D=1&ajax_page_state%5Bcss%5D%5Bsites%2Fall%2Fmodules%2Fcustom%2Femammal%2Fcss%2Fcustom.css%5D=1&ajax_page_state%5Bcss%5D%5Bsites%2Fall%2Fmodules%2Fcustom%2Femammal%2Fcss%2Fform-overrides.css%5D=1&ajax_page_state%5Bcss%5D%5Bhttps%3A%2F%2Ffonts.googleapis.com%2Fcss%3Ffamily%3DArimo%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fthemes%2Fradix%2Fassets%2Fstylesheets%2Fie.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fthemes%2Foa_radix%2Fassets%2Fstylesheets%2Fie7.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fthemes%2Foa_radix%2Fassets%2Fstylesheets%2Fie8.css%5D=1&ajax_page_state%5Bcss%5D%5Bsites%2Fall%2Fthemes%2Femammal_oa_radix%2Fassets%2Fstylesheets%2Fie7.css%5D=1&ajax_page_state%5Bcss%5D%5Bsites%2Fall%2Fthemes%2Femammal_oa_radix%2Fassets%2Fstylesheets%2Fie8.css%5D=1&ajax_page_state%5Bcss%5D%5Bsites%2Fall%2Fmodules%2Fcustom%2Femammal%2Fcss%2Fcolorizer.css%5D=1&ajax_page_state%5Bcss%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fpanopoly%2Fpanopoly_images%2Fpanopoly-images.css%5D=1&ajax_page_state%5Bjs%5D%5B0%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fpanopoly%2Fpanopoly_widgets%2Fpanopoly-widgets.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fpanopoly%2Fpanopoly_widgets%2Fpanopoly-widgets-spotlight.js%5D=1&ajax_page_state%5Bjs%5D%5Bsites%2Fall%2Fmodules%2Fcustom%2Femammal%2Fwebtrends%2Fwebtrends.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fjquery_update%2Freplace%2Fjquery%2F1.7%2Fjquery.min.js%5D=1&ajax_page_state%5Bjs%5D%5Bmisc%2Fjquery.once.js%5D=1&ajax_page_state%5Bjs%5D%5Bmisc%2Fdrupal.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Flibraries%2Funderscore%2Funderscore-min.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Flibraries%2Fbackbone%2Fbackbone-min.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Flibraries%2Fbootstrap%2Fjs%2Fbootstrap.min.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fjquery_update%2Freplace%2Fui%2Fui%2Fminified%2Fjquery.ui.core.min.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fjquery_update%2Freplace%2Fui%2Fui%2Fminified%2Fjquery.ui.widget.min.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fmedia%2Fjs%2Fmedia.core.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fjquery_update%2Freplace%2Fui%2Fui%2Fminified%2Fjquery.ui.tabs.min.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fjquery_update%2Freplace%2Fui%2Fui%2Fminified%2Fjquery.ui.accordion.min.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fjquery_update%2Freplace%2Fui%2Fexternal%2Fjquery.cookie.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fjquery_update%2Freplace%2Fmisc%2Fjquery.form.min.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Flibraries%2Fselect2%2Fselect2.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fselect2widget%2Fjs%2Fselect2widget.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Flibraries%2Fchosen%2Fchosen.jquery.min.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fjquery_update%2Freplace%2Fui%2Fui%2Fminified%2Fjquery.ui.mouse.min.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fjquery_update%2Freplace%2Fui%2Fui%2Fminified%2Fjquery.ui.resizable.min.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fjquery_update%2Freplace%2Fui%2Fui%2Fminified%2Fjquery.ui.draggable.min.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fjquery_update%2Freplace%2Fui%2Fui%2Fminified%2Fjquery.ui.button.min.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fjquery_update%2Freplace%2Fui%2Fui%2Fminified%2Fjquery.ui.position.min.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fjquery_update%2Freplace%2Fui%2Fui%2Fminified%2Fjquery.ui.dialog.min.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fmedia%2Fjs%2Futil%2Fjson2.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fmedia%2Fjs%2Futil%2Fba-debug.min.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fnavbar%2Fjs%2Fjquery.on-off-shim.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fnavbar%2Fjs%2Fmatchmedia.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fnavbar%2Fjs%2Fdebounce.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fnavbar%2Fjs%2Fdisplace.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fnavbar%2Fjs%2Fnavbar.menu.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fnavbar%2Fjs%2Fnavbar.js%5D=1&ajax_page_state%5Bjs%5D%5Bmisc%2Fform.js%5D=1&ajax_page_state%5Bjs%5D%5Bmisc%2Fajax.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fjquery_update%2Fjs%2Fjquery_update.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fnavbar%2Fjs%2Fnavbar-overlay.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fpanopoly%2Fpanopoly_images%2Fpanopoly-images.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fmedia_colorbox%2Fmedia_colorbox.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fpanopoly%2Fpanopoly_admin%2Fpanopoly-admin.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fpanopoly%2Fpanopoly_magic%2Fpanopoly-magic.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fpanopoly%2Fpanopoly_theme%2Fjs%2Fpanopoly-accordion.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fcaption_filter%2Fjs%2Fcaption-filter.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fadmin_menu%2Fadmin_menu.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fadmin_menu%2Fadmin_menu_toolbar%2Fadmin_menu_toolbar.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fdhtml_menu%2Fdhtml_menu.js%5D=1&ajax_page_state%5Bjs%5D%5Bsites%2Fall%2Fmodules%2Fcontrib%2Fmemcache%2Fmemcache_admin%2Fmemcache.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Flibraries%2Fjquery.imagesloaded%2Fjquery.imagesloaded.min.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fdevel%2Fdevel_krumo_path.js%5D=1&ajax_page_state%5Bjs%5D%5Bmisc%2Fautocomplete.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fviews_load_more%2Fviews_load_more.js%5D=1&ajax_page_state%5Bjs%5D%5Bmisc%2Ftableheader.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fviews%2Fjs%2Fbase.js%5D=1&ajax_page_state%5Bjs%5D%5Bmisc%2Fprogress.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fviews%2Fjs%2Fajax_view.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fviews_bulk_operations%2Fjs%2Fviews_bulk_operations.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fmedia%2Fjs%2Fmedia.popups.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fapps%2Foa_files%2Fjs%2Fupload.js%5D=1&ajax_page_state%5Bjs%5D%5Bsites%2Fall%2Fmodules%2Fcustom%2Femammal%2Fjs%2Fscript.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fapps%2Foa_search%2Fjs%2Foa_search.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fapps%2Foa_toolbar%2Fjs%2Ftoolbar-menu-toggle.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fflag%2Ftheme%2Fflag.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fapps%2Foa_appearance%2Foa_appearance.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fapps%2Foa_toolbar%2Fjs%2Foa-toolbar.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fthemes%2Fradix%2Fassets%2Fjavascripts%2Fmodernizr.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fmodules%2Fcontrib%2Fchosen%2Fchosen.js%5D=1&ajax_page_state%5Bjs%5D%5Bsites%2Fall%2Fthemes%2Femammal_oa_radix%2Fassets%2Fjavascripts%2Fradix-script.js%5D=1&ajax_page_state%5Bjs%5D%5Bsites%2Fall%2Fthemes%2Femammal_oa_radix%2Fassets%2Fjavascripts%2Fscript.js%5D=1&ajax_page_state%5Bjs%5D%5Bprofiles%2Fopenatrium%2Fthemes%2Fradix%2Fassets%2Fjavascripts%2Fradix-progress.js%5D=1&ajax_page_state%5Bjquery_version%5D=1.7'

        request = requests.post(url, data=body, headers=payload)
        if request.status_code == 200:
            print(request.text)
            response = json.loads(request.text)[2]['data']
            newentries = species_from_page(response)
            for key in newentries:
                if key not in allspecies:
                    allspecies[key] = newentries[key]
                else:
                    print(key+" exists")
            #print("Total length::::"+str(len(allspecies))+"\n")
        else:
            print("error:: "+str(request.status_code))
    return allspecies

def species_from_page(html):
    pagecontent = {}
    i= 0
    soup = BeautifulSoup(html,"html5lib")
    rows = soup.find(class_='views-table').find("tbody").find_all("tr")
    for row in rows:
        i += 1
        rowcells = row.find_all('td')
        atag = rowcells[1].find('a')
        name = atag.get_text()
        url = atag['href']
        pagecontent[name] = url
    print("added:::: "+str(i)+":::::"+str(len(pagecontent)))
    return pagecontent

def extract_deploymentid(deployment,payload,project_url):
    #url = 'https://emammal.si.edu/habitat-connectivity-minshan-mountains/content/'+deployment.lower()
    url = project_url+'/content/'+deployment.lower()
    request = requests.get(url, headers=payload)
    if request.status_code == 200:
        response = request.text
        soup = BeautifulSoup(response,"html5lib")
        deploymentid = soup.find(class_='field field-name-field-em-nid field-type-field-hidden-text field-label-inline clearfix').find_all("div")[2].get_text()
        return deploymentid
    else:
        print(deployment+" : "+str(request.status_code))
        #raise ValueError

def extract_species_info(speciesurl,cookie):
    #url = 'https://emammal.si.edu/habitat-connectivity-minshan-mountains/content/'+deployment.lower()
    payload = {"Host": 'emammal.si.edu'
        ,"User-Agent": 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:59.0) Gecko/20100101 Firefox/59.0'
        ,"Accept": 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'
        ,"Accept-Language": 'en-US,en;q=0.5'
        ,"Accept-Encoding": 'gzip, deflate, br'
        ,"Cache-Control": 'max-age=0, no-cache'
        ,"Connection": 'keep-alive'
        ,"Cookie": cookie
        ,"Upgrade-Insecure-Requests": "1"
        ,"Pragma": 'no-cache'}
    url = "https://emammal.si.edu"+speciesurl
    request = requests.get(url, headers=payload)
    if request.status_code == 200:
        response = request.text
        soup = BeautifulSoup(response,"html5lib")
        speciesdetails = soup.find(class_="node-species").find_all(class_='field-items')
        speciesfields =  soup.find(class_="node-species").find_all(class_='field-label')
        speciesdict = {}
        i = 0
        for field in speciesfields:
            speciesdict[field.get_text().strip()] = speciesdetails[i].get_text().strip()
            i+=1
        return speciesdict
    else:
        print(deployment+" : "+str(request.status_code))

if __name__ == '__main__':
    parser = argparse.ArgumentParser()
    parser.add_argument('action', help='Either "species" or "deployments"')
    parser.add_argument('output', help='where should the output be saved?')
    parser.add_argument('--deployments', help='provide a csv with a column named "Deployment.ID" containing deployment names')
    #parser.add_argument('--project', help='provide the project name')
    args = parser.parse_args()
    cookie = input('While logged in to eMammal, hit f12, select network, and then click home on the website. Right click the Name "home" in the developer pane, click "copy the request header" and paste it below: \n').split('Cookie: ')[1]
    print(cookie)
    if args.action == 'species':
        pages = eval(input('Paste the total number of pages.'))
        species_urls = get_species_pages(pages,cookie)
        species_details = {}
        for species in species_urls:
            species_details[species] = extract_species_info(species_urls[species],cookie)
        out_file = open(args.output, 'w')
        out_file.write(json.dumps(species_details))    
    elif args.action == 'deployments':
        print('\n')
        project = input('Paste the project url below:\n')
        if args.deployments:
            if os.path.isfile(args.deployments):
                deployments = args.deployments
            else:
                deploymnents = ''
        else:
            deployments = ''
        while not os.path.isfile(deployments):
            deployments = input('Valid file path not found. Paste the path to a csv with a column named "Deployment.ID" containing deployment names.\n')
        deployment_df = pandas.read_csv(deployments)
        payload = {"Host": 'emammal.si.edu'
            ,"User-Agent": 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:59.0) Gecko/20100101 Firefox/59.0'
            ,"Accept": 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'
            ,"Accept-Language": 'en-US,en;q=0.5'
            ,"Accept-Encoding": 'gzip, deflate, br'
            ,"Cache-Control": 'max-age=0, no-cache'
            ,"Connection": 'keep-alive'
            ,"Cookie": cookie
            ,"Upgrade-Insecure-Requests": "1"
            ,"Pragma": 'no-cache'}
        deploymentid_key = build_deploymentid_key(deployment_df,project,payload)
        deployment_df['Deployment.ID1'] = deployment_df['Deployment.ID'].apply(lambda x: deploymentid_key[x])
        deployment_df.to_csv(args.output)